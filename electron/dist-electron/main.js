"use strict";const e=require("electron"),s=require("node:path"),u=require("node:fs"),D=require("sqlite3"),p=s.join(__dirname,".."),g=s.join(p,"dist-electron"),h=s.join(p,".output/public"),w=process.env.VITE_DEV_SERVER_URL?s.join(p,"public"):h;function d(){const t={width:1920,height:1080,center:!0,autoHideMenuBar:!0,webPreferences:{preload:s.join(g,"preload.js"),webSecurity:!1,allowRunningInsecureContent:!0}},n=new e.BrowserWindow(t),i=process.env.VITE_DEV_SERVER_URL||s.join(w,"index.html");n.loadURL(i)}async function _(){return(await e.dialog.showOpenDialog({properties:["openDirectory"]})).filePaths}function E(t){e.shell.openExternal(t)}function R(t,n,i=[]){u.existsSync(`${e.app.getPath("userData")}/db`)||u.mkdirSync(`${e.app.getPath("userData")}/db`),console.log("Opening database:",`${e.app.getPath("userData")}/db/tags.db`);const a=new D.Database(`${e.app.getPath("userData")}/db/tags.db`);return new Promise((f,c)=>{const r=(l,o)=>{l?c(l):f(o)};switch(t){case"run":a.run(n,i,function(o){r(o,{id:this.lastID,changes:this.changes})});break;case"get":a.get(n,i,r);break;case"each":console.log("Verifying insertion for:",n);const l=[];a.each(n,(o,b)=>{o?c(o):l.push(b)},o=>{o?c(o):r(null,l)});break;case"all":a.all(n,i,r);break;default:c(new Error("Unknown action"))}a.close()})}function P(){e.ipcMain.handle("app-open-file-dialog",_),e.ipcMain.handle("app-open-url",(t,n)=>E(n)),e.ipcMain.handle("sqlite-operations",(t,n,i,a)=>R(n,i,a))}function I(){e.app.on("window-all-closed",()=>{process.platform!=="darwin"&&e.app.quit()}),e.app.whenReady().then(()=>{P(),d(),e.app.on("activate",()=>{e.BrowserWindow.getAllWindows().length===0&&d()})}),console.log("App initialized"),console.log("App root:",p),console.log("Main dist:",g),console.log("Renderer dist:",h),console.log("Vite public:",w),console.log("App Data:",e.app.getPath("userData"))}I();
