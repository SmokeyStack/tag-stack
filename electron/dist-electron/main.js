"use strict";const e=require("electron"),s=require("node:path"),u=require("node:fs"),f=require("sqlite3"),p=s.join(__dirname,".."),g=s.join(p,"dist-electron"),b=s.join(p,".output/public"),D=process.env.VITE_DEV_SERVER_URL?s.join(p,"public"):b;function d(){const i={width:1920,height:1080,center:!0,autoHideMenuBar:!0,webPreferences:{preload:s.join(g,"preload.js"),webSecurity:!1,allowRunningInsecureContent:!0}},n=new e.BrowserWindow(i),a=process.env.VITE_DEV_SERVER_URL||s.join(D,"index.html");n.loadURL(a)}async function _(){return(await e.dialog.showOpenDialog({properties:["openDirectory"]})).filePaths}function E(i){e.shell.openExternal(i)}function R(i,n,a=[]){u.existsSync(`${e.app.getPath("userData")}/db`)||u.mkdirSync(`${e.app.getPath("userData")}/db`);const o=new f.Database(`${e.app.getPath("userData")}/db/tags.db`);return new Promise((h,r)=>{const l=(c,t)=>{c?r(c):h(t)};switch(i){case"run":o.run(n,a,function(t){l(t,{id:this.lastID,changes:this.changes})});break;case"get":o.get(n,a,l);break;case"each":console.log("Verifying insertion for:",n);const c=[];o.each(n,(t,w)=>{t?r(t):c.push(w)},t=>{t?r(t):l(null,c)});break;case"all":o.all(n,a,l);break;default:r(new Error("Unknown action"))}o.close()})}function P(){return e.app.getPath("userData")}function I(){e.ipcMain.handle("app-open-file-dialog",_),e.ipcMain.handle("app-open-url",(i,n)=>E(n)),e.ipcMain.handle("sqlite-operations",(i,n,a,o)=>R(n,a,o)),e.ipcMain.handle("get-user-data-path",P)}function V(){e.app.on("window-all-closed",()=>{process.platform!=="darwin"&&e.app.quit()}),e.app.whenReady().then(()=>{I(),d(),e.app.on("activate",()=>{e.BrowserWindow.getAllWindows().length===0&&d()})})}V();
